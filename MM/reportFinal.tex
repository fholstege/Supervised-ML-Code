% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Which Variables Contribute to Air Quality? Evidence From California},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering

\title{Which Variables Contribute to Air Quality? Evidence From California}
\author{}
\date{\vspace{-2.5em}}

\begin{document}
\maketitle

\hypertarget{introduction}{%
\subsection{Introduction}\label{introduction}}

World Health Organization estimates 7 million that air pollution
contributes to the death of 7 million people, anually (WHO 2020). For
policymakers, it is thus impportant to understand which factors
contribute to air quality, in order to target their efforts to improve
it. This study aims to pinpoint the factors that contribute to air
quality, using multiple regression. The factors considered in this study
are rainfall, population density, income per capita, added value of
companies and adjacency to coast. To find which combination of these
variables best described their relationship on air quality, we use the
better subset selection algorithm (Xiong 2014). Previous work showed
this algorithm yields a better fit than a subset without optimization as
the result of its monotonicity (Xiong 2014). Our data revealed that
whether or not an area is coastal was the only statistically significant
variable.

\hypertarget{Data}{%
\subsection{Data}\label{Data}}

Previous work has suggested the relation between the five chosen
variables and air quality. Both natural and anthropogenic events
attribute to air quality in the atmosphere. The distribution of air
pollution mainly depends on the wind field (Leelőssy et al. 2014), which
is quantified by the variable of adjacency to coast and rainfall in this
study as they both reflect the wind field's condition. Air quality is
also influenced by the production and consumption from society, leading
to emmissions (Baklanov, Molina, and Gauss 2016). To account for this,
our study includes variables on population density, income per capita
and added values from companies. We use the econometrics dataset on air
quality in California for 1972 (r-project 2020). The dependent variable
is an indicator of air quality (Ruoying - can you find what this
indicator consists of?), the lower the better. The independent variables
under study are rainfall(inch), population density(per square mile),
income per capita (\$), added value of companies (\$) and adjacency to
coast(binary). The dataset has 30 set of observations, each being a
different metropolitan area in California. As the unit of each variable
is heterogenerous, we scaled all independent variables to have a mean of
0 and a variance of 1, to ensure fair interpretation of the model
coefficents. Scaling also ensures the MM algorithm converges faster
(Ruoying - can you add a citation for why this is the case?)

\hypertarget{Method}{%
\subsection{Method}\label{Method}}

Multiple regression is an extension of simple linear regression, which
makes a linear combination of several explanatory predictors to predict
the outcome of a response variable Y: \[
\begin{align}
Y = \beta_0 + \beta_1 &X_1+\beta_2 X_2 +...+ \beta_p X_p + \epsilon,
\\
\boldsymbol{y} = \mathbf{X} \boldsymbol{\beta} + \epsilon,
\end{align}
\] with Y denotes random response variable, X denotes random vectors of
p predictor variables, \(\boldsymbol{y}\) means observed n vector of
response variable, \(\mathbf{X}\) include n\(\times\)(p+1) predictor
variables with first column of ones for the intercept, and
\(\boldsymbol{\beta}\) denotes (p+1) vector of
weights\([\beta_0, \beta_1, \beta_2,...,\beta_p]^\top\). To minimize RSS
\((\boldsymbol{\beta})\) over \(\boldsymbol{\beta}\) with \[
\begin{align}
RSS (\boldsymbol{\beta}) = \mathbf{e}^\top \mathbf{e} = (\mathbf{y-X\boldsymbol{\beta}})&^\top (\mathbf{y-X\boldsymbol{\beta})},
\\
=\mathbf{y}^\top \mathbf{y} + \boldsymbol{\beta}^\top\mathbf{X}^\top\mathbf{X}\boldsymbol{\beta} -2\boldsymbol{\beta}\mathbf{X}^\top \mathbf{y}.
\end{align}
\] The difficult part of minimizing \(RSS (\boldsymbol{\beta})\) lies in
\(\boldsymbol{\beta}^\top\mathbf{X}^\top\mathbf{X}\boldsymbol{\beta}\),
thus we need to find majorizing function of the form
\(\lambda\boldsymbol{\beta}^\top\boldsymbol{\beta}\). Here we apply an
MM-based iterative algorithm to minimize RSS(\(\boldsymbol{\beta}\)),
the basic idea is to replace original function f(x) by a simpler
function, the majorizing function g(x,y). To apply an MM algorithm for
multiple regression, Choose with some initial \(\beta_0\in\mathbb{R}^p\)
and small \(\epsilon\), then compute \(RSS (\boldsymbol{\beta_0})\),
also compute \(\lambda\) as the largest eigenvalue of
\(\mathbf{X}^\top\mathbf{X}\). Then set \(k\leftarrow1\), while k=1 or
\((RSS (\boldsymbol{\beta_{k-1}})-(\boldsymbol{\beta_{k}}))/RSS (\boldsymbol{\beta_{k-1}})>\epsilon\)do
\(k\leftarrow k+1\), also update
\(\beta^{(k)} = \beta_{k-1} - \lambda^{-1}\mathbf{X}^\top\mathbf{X}\beta_{k-1} +\lambda^{-1}\mathbf{X}^\top\mathbf{y}\).
As a check, print k,\(RSS (\boldsymbol{\beta_{k}})\), and
\(RSS (\boldsymbol{\beta_{k-1}})-RSS (\boldsymbol{\beta_{k}})\).
Besides, to find which predictors are important, we have to try to find
best subset of m nonzero weights in \(\beta\). For fixed m, we utilise
better subset selection as a tool in our report. Better subset selection
is an approximate algorithm based on MM, the same majorizing function is
used as in the MM algorithm for multiple regression. We have: \[
\begin{align}
RSS (\boldsymbol\beta)\leq\lambda\boldsymbol\beta^\top\boldsymbol\beta&-2\lambda\boldsymbol\beta^\top\boldsymbol{u}+c_2
\\
=\lambda\sum_{j=1}^p (\beta_{j}&-u_{j})^2 + c_{3} 
\\
= g(\boldsymbol\beta,\boldsymbol\beta_{0})
\end{align}
\] Only m values of \(\beta_{j}\) can be chosen different from 0. Then
sort\(|u_{j}|\) from large to small and set \(\beta_{j}^+\) = \(u_{j}\)
for the first m elements. This choice ensures that
\(g(\boldsymbol\beta,\boldsymbol\beta_{0})\) is minimal.

\hypertarget{Result}{%
\subsection{Result}\label{Result}}

We use the better subset method to select the best model for an M number
of variables, with \(M \in [1,5]\). To assess the overall fit of each
model, we look at adjusted \(R^2\). We use this statistic because while
it summarizes the \% of the variance explained by the independent
variables, it accounts for the fact that adding variables could improve
the \(R^2\) by random chance. The model that best explains the variance
in air quality is the model in which all 5 variables are included, with
an adjusted-\(R^2\) of 25.4\%. In this model (and all the others), the
only statistically significant variable is the binary variable on
coastal area. In the model with the best fit, one standard deviation in
the coastal area variable leads to an decrease of -15.7 points in the
air quality index. Rescaling this, it estimates that if a metropolitan
area is coastal, the expected decrease in the air quality index (and
thus improvement of air quality) is \ldots.. The other variables have no
statistically significant effect on air quality

\begin{table}[!htbp] \centering 
  \label{} 
\begin{tabular}{@{\extracolsep{5pt}}lccccc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 & \multicolumn{5}{c}{\textit{Dependent variable:}} \\ 
\cline{2-6} 
\\[-1.8ex] & \multicolumn{5}{c}{Air Quality} \\ 
\\[-1.8ex] & (1) & (2) & (3) & (4) & (5)\\ 
\hline \\[-1.8ex] 
 Coastal Area & $-$13.73$^{***}$ & $-$13.83$^{***}$ & $-$14.85$^{***}$ & $-$14.98$^{***}$ & $-$15.57$^{***}$ \\ 
  & (-2.54) & ($-$2.76) & ($-$2.98) & ($-$3.03) & ($-$3.19) \\ 
  & & & & & \\ 
 Value Added & - & 9.26 & 3.63 & 3.33 & 4.090 \\ 
  &  & (0.86) & (0.34) & (0.31) & (0.39) \\ 
  & & & & & \\ 
 Median Income & - & - & 6.3 & 7.2 & 6.9 \\ 
  &  &  & (0.58) & (0.67) & (0.65) \\ 
  & & & & & \\ 
 Population Density & - & - & - & $-$2.94 & $-$3.04 \\ 
  &  &  &  & ($-$0.63) & ($-$0.66) \\ 
  & & & & & \\ 
  Rain  & - & - & - & - & 3.38 \\ 
  &  &  &  & & 0.72 \\ 
  & & & & & \\ 
 Intercept & 104.700$^{***}$ & 104.700$^{***}$ & 104.700$^{***}$ & 104.700$^{***}$ & 104.700$^{***}$ \\ 
  & (21.34) & (23.075) & (23.24) & (23.43) & (23.69) \\ 
  & & & & & \\ 
\hline \\[-1.8ex] 
Observations & 30 & 30 & 30 & 30 & 30 \\ 
R$^{2}$ & 0.240 & 0.349 & 0.359 & 0.369 & 0.383 \\ 
Adjusted R$^{2}$ & 0.08 & 0.214 & 0.23 & 0.24 & 0.25 \\ 
\hline 
\hline \\[-1.8ex] 
\textit{Note:}  & \multicolumn{5}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\ 
\end{tabular} 
\end{table}

\hypertarget{limitations-conclusion-and-future-research.}{%
\subsection{Limitations, Conclusion, and Future
Research.}\label{limitations-conclusion-and-future-research.}}

Apart from the limitations to our dataset, we should note several other
limitations to our applied method. First, there are other variables that
affect air polution that we did not consider. An example is \ldots..
(add citation). Second, while our method is appropriate for estimating
linear relationships, previous research has shown that the effects of
certain variables on air pollution is non-linear - one such example is
environmental regulation (\ldots{} add citation). \textbackslash{}
\textbackslash{} Our results suggest that coastal areas experience much
better air quality than non-coastal areas. This has implications for
policymakers. It provides evidence for initiatives that move residents
to coastal areas to expose them to enhanced air quality. One such
initiative was recently announced in Taiwan: ..On the other hand, our
results suggest that policies which aim to limit population density or
economic activity might be less effective than previously thought, since
we found no statistically significant relationship between these
variables and air pollution. \textbackslash{} \textbackslash{} Future
research should aim to add more areas, years, and variables to our
analysis to consider other possibilities. In addition, while there is
some existing research on air quality in coastal areas (see\ldots.), it
is worth further disentangling the geographic aspects of coastal areas
that lead to an improvement in air quality, to see if those aspects that
can be recreated in non-coastal areas.

\hypertarget{Reference}{%
\subsection{Reference}\label{Reference}}

\hypertarget{functions}{%
\subsubsection{Functions}\label{functions}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# calcRSS: Calculates the residual squared errors for a multiple regression of the form Y = XBeta + e}
\CommentTok{# }
\CommentTok{# Parameters: }
\CommentTok{#   mX: Matrix of n x p (n = observations, p = independent variables)}
\CommentTok{#   mY: Column matrix of n x 1 dependent variables (n = observations)}
\CommentTok{#   mBeta: Column Matrix of p x 1 coefficients}
\CommentTok{#   }
\CommentTok{# Output:}
\CommentTok{#   ESquared: double, residual squared errors}

\NormalTok{calcRSS <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(mX, mY,mBeta)\{}
  
  \CommentTok{# calculate the errors}
\NormalTok{  mE <-}\StringTok{  }\NormalTok{mY }\OperatorTok{-}\StringTok{ }\NormalTok{mX }\OperatorTok{%*%}\StringTok{ }\NormalTok{mBeta}
  
  \CommentTok{# get errors squared}
\NormalTok{  ESquared <-}\StringTok{ }\KeywordTok{t}\NormalTok{(mE) }\OperatorTok{%*%}\StringTok{ }\NormalTok{mE}
  
  \CommentTok{# return the residual sum of squared errors}
  \KeywordTok{return}\NormalTok{(ESquared[}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{])}
  
\NormalTok{\}}

\CommentTok{# calcCovar: Calculates the covariance matrix }
\CommentTok{#}
\CommentTok{# Parameters: }
\CommentTok{#   RSS: Residual squared errors}
\CommentTok{#   mXtX: pxp matrix, created from independent variables (X), multiplied with itself}
\CommentTok{#   n: double, number of observations}
\CommentTok{#   p: double, number of variables}
\CommentTok{#}
\CommentTok{# Output:}
\CommentTok{#   Covar: matrix, covariance matrix}

\NormalTok{calcCovar <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(RSS, mXtX,n, p)\{}
  
  \CommentTok{# est. for sigma squared}
\NormalTok{  SigmaSquared <-}\StringTok{ }\NormalTok{(RSS) }\OperatorTok{/}\StringTok{ }\NormalTok{(n }\OperatorTok{-}\StringTok{ }\NormalTok{p }\DecValTok{-1}\NormalTok{)}
  
\NormalTok{  Covar <-}\StringTok{ }\NormalTok{SigmaSquared }\OperatorTok{*}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(}\KeywordTok{inv}\NormalTok{(mXtX))}
  
  \KeywordTok{return}\NormalTok{(Covar)}
  
\NormalTok{\}}

\CommentTok{# calcSignificance: Calculates the statistical significance of a set of beta's}
\CommentTok{#}
\CommentTok{# Parameters: }
\CommentTok{#   RSS: Residual squared errors}
\CommentTok{#   mXtX: pxp matrix, created from independent variables (X), multiplied with itself}
\CommentTok{#   n: double, number of observations}
\CommentTok{#   p: double, number of variables}
\CommentTok{#   mBetaEst: matrix of estimated Beta's}
\CommentTok{#}
\CommentTok{# Output:}
\CommentTok{#   dfSignificance: dataframe, containing the results on statistical signficance}

\NormalTok{calcSignificance <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(RSS, mXtX, n,p, mBetaEst)\{}
  
  \CommentTok{# get covariance matrix}
\NormalTok{  mCovar <-}\StringTok{ }\KeywordTok{calcCovar}\NormalTok{(RSS,mXtX,n,p)}
  
  \CommentTok{# calculate the standard deviations}
\NormalTok{  stdev <-}\StringTok{ }\KeywordTok{sqrt}\NormalTok{(}\KeywordTok{diag}\NormalTok{(mCovar))}
  
  \CommentTok{# define t, which is t-distributed with n-p-1 degrees of freedom }
\NormalTok{  t <-}\StringTok{ }\NormalTok{mBetaEst}\OperatorTok{/}\NormalTok{stdev}
\NormalTok{  pval <-}\StringTok{ }\DecValTok{2}\OperatorTok{*}\KeywordTok{pt}\NormalTok{(}\OperatorTok{-}\KeywordTok{abs}\NormalTok{(t),}\DataTypeTok{df=}\NormalTok{n}\OperatorTok{-}\NormalTok{p}\DecValTok{-1}\NormalTok{)}
  
\NormalTok{  dfSignificance <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}\DataTypeTok{BetaEst =}\NormalTok{ mBetaEst, }
                               \DataTypeTok{stdev =}\NormalTok{ stdev, }
                               \DataTypeTok{t =}\NormalTok{ t, }
                               \DataTypeTok{pval =}\NormalTok{ pval)}
  
  \KeywordTok{return}\NormalTok{(dfSignificance)}
\NormalTok{\}}

\CommentTok{# calcLargestEigen: Calculates the largest eigenvalue of an matrix of independent variables}
\CommentTok{# }
\CommentTok{# Parameters: }
\CommentTok{#   mX: Dataframe of n x p (n = observations, p = independent variables)}
\CommentTok{#   }
\CommentTok{# Output:}
\CommentTok{#   LargestEigenval: float, largest eigenvalue of said matrix}

\NormalTok{calcLargestEigen <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(mX)\{}
  
  \CommentTok{# get the eigenvalues of X }
\NormalTok{  EigenValX <-}\StringTok{ }\KeywordTok{eigen}\NormalTok{(mX)}\OperatorTok{$}\NormalTok{values}
  
  \CommentTok{# from these eigenvalues, get the largest one}
\NormalTok{  LargestEigenVal <-}\StringTok{ }\KeywordTok{max}\NormalTok{(EigenValX, }\DataTypeTok{na.rm =} \OtherTok{TRUE}\NormalTok{)}
  
  \KeywordTok{return}\NormalTok{(LargestEigenVal)}
  
\NormalTok{\}}

\CommentTok{# CalcStepScore: Calculates the % improvement between the k-1th and kth set of beta's}
\CommentTok{# }
\CommentTok{# Parameters:}
\CommentTok{#   prevBeta: double, k-1th beta}
\CommentTok{#   currbeta: double, kth beta}
\CommentTok{#   mX: Dataframe of n x p (n = observations, p = independent variables)}
\CommentTok{# }
\CommentTok{# Output: }
\CommentTok{#   StepScore; double, % improvement between the RSS of the two sets of beta's}

\NormalTok{calcStepScore <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(mX,mY, prevBeta, currBeta)\{}
  
  \CommentTok{# difference in RSS between previous and current set of beta's}
\NormalTok{  diffRSS <-}\StringTok{ }\NormalTok{(}\KeywordTok{calcRSS}\NormalTok{(mX,mY,prevBeta) }\OperatorTok{-}\StringTok{ }\KeywordTok{calcRSS}\NormalTok{(mX,mY,currBeta))}
  
  \CommentTok{# divide difference with previous score to get % change}
\NormalTok{  StepScore <-}\StringTok{ }\NormalTok{diffRSS }\OperatorTok{/}\KeywordTok{calcRSS}\NormalTok{(mX,mY,prevBeta)}
  
  \KeywordTok{return}\NormalTok{(StepScore)}
  
\NormalTok{\}}

\CommentTok{# calcRsquared}
\CommentTok{#}
\CommentTok{# Calculates the r-squared}
\CommentTok{#}
\CommentTok{# Parameters:}
\CommentTok{#   Y: matrix, the true dependent variable   }
\CommentTok{#   Yest: matrix, the predicted dependent variable}
\CommentTok{#   (optional) adjusted: if True, return adjusted r squared}
\CommentTok{#   (optional) p: if adjusted is calculated, add number of variables}
\CommentTok{# }
\CommentTok{# Output:}
\CommentTok{#   Rsquared: double, the Rsquared or adjusted Rsquared for a linear model}

\NormalTok{calcRsquared <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(mY, mYest, }\DataTypeTok{adjusted =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{p=}\DecValTok{0}\NormalTok{, }\DataTypeTok{n=}\DecValTok{0}\NormalTok{)\{}
  
  \CommentTok{# standardize Y, and Yest (mean of 0)}
\NormalTok{  mStandY =}\StringTok{ }\NormalTok{mY }\OperatorTok{-}\StringTok{ }\KeywordTok{mean}\NormalTok{(mY)}
\NormalTok{  mStandYest =}\StringTok{ }\NormalTok{mYest }\OperatorTok{-}\StringTok{ }\KeywordTok{mean}\NormalTok{(mYest)}
  
  \CommentTok{# calculate Rsquared}
\NormalTok{  numerator <-}\StringTok{ }\NormalTok{(}\KeywordTok{t}\NormalTok{(mStandY) }\OperatorTok{%*%}\StringTok{ }\NormalTok{mStandYest)}\OperatorTok{^}\DecValTok{2}
\NormalTok{  denominator <-}\StringTok{ }\NormalTok{(}\KeywordTok{t}\NormalTok{(mStandY) }\OperatorTok{%*%}\StringTok{ }\NormalTok{mY) }\OperatorTok{%*%}\StringTok{ }\NormalTok{(}\KeywordTok{t}\NormalTok{(mStandYest) }\OperatorTok{%*%}\StringTok{ }\NormalTok{mStandYest)}
\NormalTok{  resultRsquared <-}\StringTok{ }\NormalTok{(numerator}\OperatorTok{/}\NormalTok{denominator)}
  
  \CommentTok{# if want adjusted R squared, }
  \ControlFlowTok{if}\NormalTok{(adjusted)\{}
    
\NormalTok{    adjRsquared =}\StringTok{ }\DecValTok{1} \OperatorTok{-}\StringTok{ }\NormalTok{(((}\DecValTok{1}\OperatorTok{-}\NormalTok{resultRsquared)}\OperatorTok{*}\NormalTok{(n }\OperatorTok{-}\StringTok{ }\DecValTok{1}\NormalTok{))}\OperatorTok{/}\NormalTok{(n}\OperatorTok{-}\NormalTok{p}\DecValTok{-1}\NormalTok{))}
\NormalTok{    resultRsquared <-}\StringTok{ }\NormalTok{adjRsquared}
\NormalTok{  \}}
  
  \KeywordTok{return}\NormalTok{(resultRsquared)}
  
\NormalTok{\}}

\CommentTok{# calcModelMM}
\CommentTok{#}
\CommentTok{# Calculates a linear model, using the majorization in minimization (MM) algorithm}
\CommentTok{#}
\CommentTok{# Parameters:}
\CommentTok{#   X: Dataframe of n x p (n = observations, p = independent variables)}
\CommentTok{#   Y: Dataframe of n x 1 dependent variables (n = observations)}
\CommentTok{#   e: epsilon, parameter for threshold of improvement after which the algorithm should halt}
\CommentTok{#   nBeta: number of variables one wants to use}
\CommentTok{#}
\CommentTok{# Output:}
\CommentTok{#   result: dataframe with attributes of the model: }
\CommentTok{#       - Beta: dataframe, the calculated Beta's}
\CommentTok{#       - RSS: double, Sum of squared residuals}
\CommentTok{#       - Yest: dataframe, the predicted Y}
\CommentTok{#       - Rsquared: double, R^2 for the predicted Y}
\CommentTok{#       - AdjRsquared: Adjusted Rsquared}
\CommentTok{#       - Significance results: dataframe with significance results on the beta's}
\CommentTok{#       - Residuals: dataframe, Y - Yest.}
\CommentTok{#}

\NormalTok{calcModelMM <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(mX,mY,e, nBeta)\{}
  
  \CommentTok{# get number of observations, and number of variables minues the intercept}
\NormalTok{  n <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(mX)}
\NormalTok{  p <-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(mX) }\OperatorTok{-}\StringTok{ }\DecValTok{1}
  
  \CommentTok{# check the user has filled in an appropriate amount of beta's}
  \ControlFlowTok{if}\NormalTok{(nBeta }\OperatorTok{>}\StringTok{ }\NormalTok{p }\OperatorTok{+}\StringTok{ }\DecValTok{1}\NormalTok{)\{}
    \KeywordTok{stop}\NormalTok{(}\StringTok{"You want to use more variables than there are in the dataset of independent variables"}\NormalTok{)}
\NormalTok{  \}}
  
  \CommentTok{# set the previous beta variable to initial, random beta's}
\NormalTok{  prevBeta <-}\StringTok{ }\KeywordTok{runif}\NormalTok{(}\KeywordTok{ncol}\NormalTok{(mX), }\DataTypeTok{min=}\DecValTok{0}\NormalTok{, }\DataTypeTok{max=}\DecValTok{1}\NormalTok{)}
  
  \CommentTok{# calculate X'X}
\NormalTok{  mXtX <-}\StringTok{ }\KeywordTok{t}\NormalTok{(mX) }\OperatorTok{%*%}\StringTok{ }\NormalTok{mX}
  
  \CommentTok{# get largest eigenvalue for the square of independent variables}
\NormalTok{  Lambda <-}\StringTok{ }\KeywordTok{calcLargestEigen}\NormalTok{(mXtX)}
  
  \CommentTok{# set initial stepscore to 0, k to 1. }
\NormalTok{  StepScore <-}\StringTok{ }\DecValTok{0}
\NormalTok{  k <-}\StringTok{ }\DecValTok{1}
  
  \CommentTok{# run while, either if k is equal to 1, or the improvement between k-1th and kth set of beta's is smaller than the parameter e}
  \ControlFlowTok{while}\NormalTok{ (k }\OperatorTok{==}\StringTok{ }\DecValTok{1} \OperatorTok{|}\StringTok{ }\NormalTok{StepScore }\OperatorTok{>}\StringTok{ }\NormalTok{e )\{}
    
    \CommentTok{# step to next k}
\NormalTok{    k <-}\StringTok{ }\NormalTok{k }\OperatorTok{+}\StringTok{ }\DecValTok{1}
    
    \CommentTok{# calculate beta's for this k}
\NormalTok{    BetaK <-}\StringTok{ }\NormalTok{prevBeta }\OperatorTok{-}\StringTok{ }\NormalTok{((}\DecValTok{1}\OperatorTok{/}\NormalTok{Lambda) }\OperatorTok{*}\StringTok{  }\NormalTok{mXtX }\OperatorTok{%*%}\StringTok{ }\NormalTok{prevBeta) }\OperatorTok{+}\StringTok{ }\NormalTok{((}\DecValTok{1}\OperatorTok{/}\NormalTok{Lambda) }\OperatorTok{*}\StringTok{ }\KeywordTok{t}\NormalTok{(mX) }\OperatorTok{%*%}\StringTok{ }\NormalTok{mY )}
    
    \CommentTok{# sort the beta's based on absolute value, remove the smallest ones to keep m }
\NormalTok{    absBetaKOrdered <-}\StringTok{ }\KeywordTok{order}\NormalTok{(}\KeywordTok{abs}\NormalTok{(BetaK[,}\DecValTok{1}\NormalTok{]), }\DataTypeTok{decreasing =}\NormalTok{ T)}
\NormalTok{    BetaK[}\OperatorTok{!}\NormalTok{BetaK }\OperatorTok{%in%}\StringTok{ }\NormalTok{BetaK[absBetaKOrdered,][}\DecValTok{1}\OperatorTok{:}\NormalTok{nBeta]] <-}\StringTok{ }\DecValTok{0}
    
    \CommentTok{# new stepscore, % difference in RSS between new Beta's and previous beta's}
\NormalTok{    StepScore <-}\StringTok{ }\KeywordTok{calcStepScore}\NormalTok{(mX,mY,prevBeta,BetaK)}
    
    \CommentTok{# assign current beta's to prevBeta variable for next iteration}
\NormalTok{    prevBeta <-}\StringTok{ }\NormalTok{BetaK}
    
    
\NormalTok{  \}}
  
  \CommentTok{## Calculate several attributes of the linear model, put in dataframes or doubles}

  \CommentTok{# final Beta's}
\NormalTok{  BetaFinal <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(BetaK)}
  
  \CommentTok{# calculate the RSS of this final est.}
\NormalTok{  RSSBetaK <-}\StringTok{ }\KeywordTok{calcRSS}\NormalTok{(mX,mY, BetaK)}
  
  \CommentTok{# get the est. dependent variables}
\NormalTok{  mYest <-}\StringTok{ }\NormalTok{mX }\OperatorTok{%*%}\StringTok{ }\NormalTok{BetaFinal}
  
  \CommentTok{# get the r2 and adjusted r2}
\NormalTok{  Rsquared <-}\StringTok{ }\KeywordTok{calcRsquared}\NormalTok{(mY, mYest)}
\NormalTok{  adjRsquared <-}\StringTok{ }\KeywordTok{calcRsquared}\NormalTok{(mY,mYest, }\DataTypeTok{adjusted =}\NormalTok{ T,  p, n)}
  
  \CommentTok{# get the residuals}
\NormalTok{  Resi <-}\StringTok{ }\NormalTok{mY }\OperatorTok{-}\StringTok{ }\NormalTok{mYest}
  
  \CommentTok{# get the results on significance}
\NormalTok{  dfSignificance <-}\StringTok{ }\KeywordTok{calcSignificance}\NormalTok{(RSSBetaK, mXtX, n, p, BetaFinal)}
  
  \CommentTok{# add these attributes together as a list to make it easily accessible}
\NormalTok{  result <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}\DataTypeTok{Beta =}\NormalTok{ BetaFinal, }
                  \DataTypeTok{RSS =}\NormalTok{ RSSBetaK, }
                  \DataTypeTok{Yest =}\NormalTok{ mYest,}
                  \DataTypeTok{Rsquared =}\NormalTok{ Rsquared, }
                  \DataTypeTok{adjRsquared =}\NormalTok{ adjRsquared, }
                  \DataTypeTok{SignificanceResults =}\NormalTok{ dfSignificance,}
                  \DataTypeTok{Residuals =}\NormalTok{ Resi, }
                  \DataTypeTok{n =}\NormalTok{ n,}
                  \DataTypeTok{p =}\NormalTok{ p)}
  
  
  \KeywordTok{return}\NormalTok{(result)}
  
\NormalTok{\}}

\CommentTok{# findModelMM}
\CommentTok{#}
\CommentTok{# finds the best linear model, using the MM algorithm, by testing model with 1, 2...up to all variables in X}
\CommentTok{#}
\CommentTok{# Parameters:}
\CommentTok{#   mX: Matrix of n x p (n = observations, p = independent variables)}
\CommentTok{#   mY: Matrix of n x 1 dependent variables (n = observations)}
\CommentTok{#}
\CommentTok{# Output:}
\CommentTok{#   results: list with the results for each model version}

\NormalTok{findModelMM <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(mX, mY, e)\{}
  
  \CommentTok{# get the number of independent variables used}
\NormalTok{  nIndVar =}\StringTok{ }\KeywordTok{ncol}\NormalTok{(mX) }\OperatorTok{-}\StringTok{ }\DecValTok{1}
  
  \CommentTok{# start at m = 1, create empty list to be filled with results}
\NormalTok{  M =}\StringTok{ }\DecValTok{1}
\NormalTok{  results <-}\StringTok{ }\KeywordTok{list}\NormalTok{()}
  
  \CommentTok{# for each m, check the best model and save the results}
  \ControlFlowTok{while}\NormalTok{(M }\OperatorTok{<=}\StringTok{ }\NormalTok{nIndVar)\{}
    
\NormalTok{    M <-}\StringTok{ }\NormalTok{M }\OperatorTok{+}\StringTok{ }\DecValTok{1}
    
\NormalTok{    resultM <-}\StringTok{ }\KeywordTok{calcModelMM}\NormalTok{(mX, mY, e, M)}
    
\NormalTok{    strSave <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Model with "}\NormalTok{, M}\DecValTok{-1}\NormalTok{, }\StringTok{" variable(s)"}\NormalTok{)}
\NormalTok{    results[[strSave]] <-}\StringTok{ }\NormalTok{resultM}
    
\NormalTok{  \}}
  
  \KeywordTok{return}\NormalTok{(results)}
  
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{analysis}{%
\subsection{Analysis}\label{analysis}}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(matlib)}
\KeywordTok{library}\NormalTok{(stargazer)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: package 'stargazer' was built under R version 4.0.3
\end{verbatim}

\begin{verbatim}
## 
## Please cite as:
\end{verbatim}

\begin{verbatim}
##  Hlavac, Marek (2018). stargazer: Well-Formatted Regression and Summary Statistics Tables.
\end{verbatim}

\begin{verbatim}
##  R package version 5.2.2. https://CRAN.R-project.org/package=stargazer
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(sjPlot)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: package 'sjPlot' was built under R version 4.0.3
\end{verbatim}

\begin{verbatim}
## Registered S3 methods overwritten by 'lme4':
##   method                          from
##   cooks.distance.influence.merMod car 
##   influence.merMod                car 
##   dfbeta.influence.merMod         car 
##   dfbetas.influence.merMod        car
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# load the air quality data}
\KeywordTok{load}\NormalTok{(}\StringTok{"Data/Airq_numeric.Rdata"}\NormalTok{)}

\CommentTok{# set to dataframe}
\NormalTok{dfAirQ <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(Airq)}

\CommentTok{# select dependent variable of air quality}
\NormalTok{Yair =}\StringTok{ }\NormalTok{dfAirQ}\OperatorTok{$}\NormalTok{airq}

\CommentTok{# select all other variables as independent variables}
\NormalTok{Xair =}\StringTok{ }\NormalTok{dfAirQ[,}\OperatorTok{-}\DecValTok{1}\NormalTok{]}

\CommentTok{# scale the independent variables, and add an intercept to these}
\NormalTok{XairScaled <-}\StringTok{ }\KeywordTok{scale}\NormalTok{(Xair)}
\NormalTok{XairIntercept <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(}\DataTypeTok{intercept =} \DecValTok{1}\NormalTok{, XairScaled)}

\CommentTok{# set the data to matrix format}
\NormalTok{mYair <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(Yair)}
\NormalTok{mXairIntercept <-}\StringTok{ }\KeywordTok{as.matrix}\NormalTok{(XairIntercept)}

\CommentTok{# set seed to ensure stability of results}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{0}\NormalTok{)}

\CommentTok{# set e small}
\NormalTok{e <-}\StringTok{ }\FloatTok{0.0000000001}

\CommentTok{# select the number of beta's you want to use in the model}
\NormalTok{nBeta <-}\StringTok{ }\KeywordTok{ncol}\NormalTok{(mXairIntercept) }\OperatorTok{-}\StringTok{ }\DecValTok{1}

\CommentTok{# calculate the model using the MM algorithm, using the max (5) variables}
\NormalTok{modelMM <-}\StringTok{ }\KeywordTok{calcModelMM}\NormalTok{(mXairIntercept, mYair, e, nBeta)}

\CommentTok{# calculate the model with MM, for 1-5 variables. This contains all the values shown in the paper }
\NormalTok{compareModelMM <-}\StringTok{ }\KeywordTok{findModelMM}\NormalTok{(mXairIntercept, mYair, e)}
\end{Highlighting}
\end{Shaded}

\hypertarget{refs}{}
\leavevmode\hypertarget{ref-baklanov2016megacities}{}%
Baklanov, Alexander, Luisa T Molina, and Michael Gauss. 2016.
``Megacities, Air Quality and Climate.'' \emph{Atmospheric Environment}
126: 235--49.

\leavevmode\hypertarget{ref-leelHossy2014dispersion}{}%
Leelőssy, Ádám, Ferenc Molnár, Ferenc Izsák, Ágnes Havasi, István Lagzi,
and Róbert Mészáros. 2014. ``Dispersion Modeling of Air Pollutants in
the Atmosphere: A Review.'' \emph{Central European Journal of
Geosciences} 6 (3): 257--78.

\leavevmode\hypertarget{ref-RstudioData}{}%
r-project. 2020. ``Ecdat: Data Sets for Econometrics.'' World Health
Organization.
\url{https://cran.r-project.org/web/packages/Ecdat/index.html}.

\leavevmode\hypertarget{ref-WHOestimation}{}%
WHO. 2020. ``Air Pollution.'' World Health Organization.
\url{https://www.who.int/health-topics/air-pollution\#tab=tab_1}.

\leavevmode\hypertarget{ref-xiong2014better}{}%
Xiong, Shifeng. 2014. ``Better Subset Regression.'' \emph{Biometrika}
101 (1): 71--84.

\end{document}
